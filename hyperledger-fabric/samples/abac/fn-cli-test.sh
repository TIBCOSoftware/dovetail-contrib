#!/bin/bash

# abac_cc tests executed from cli docker container of the Fabric sample first-network

. ./utils.sh
ORDERER_ARGS="-o orderer.example.com:7050 --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem"
ORG1_ARGS="--peerAddresses peer0.org1.example.com:7051 --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt"
ORG2_ARGS="--peerAddresses peer0.org2.example.com:9051 --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt"

# invoke cid
echo "invoke cid, will fail to authorize because Admin user cert does not have abac.init attribute ..."
peer chaincode invoke $ORDERER_ARGS -C mychannel -n abac_cc $ORG1_ARGS $ORG2_ARGS -c '{"Args":["check_abac","Admin"]}'
